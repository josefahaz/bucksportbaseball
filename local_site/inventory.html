<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bucksport Little League - Equipment Inventory</title>
  <script src="js/mobile-detect.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #4b2d72;
      --secondary: #ffc72c;
      --light: #f8f9fa;
      --dark: #343a40;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
    }
    body {
      background-color: #4b2d72;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.5;
      display: flex;
      min-height: 100vh;
    }
    /* Sidebar Styles */
    .sidebar {
      width: 250px;
      background-color: #4b2d72;
      color: white;
      padding: 1.5rem 1rem;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 1000;
    }
    
    .sidebar h2 {
      color: #ffc72c;
      margin-bottom: 2rem;
      padding: 0 0.5rem;
      font-size: 1.25rem;
      font-weight: 700;
    }
    
    .sidebar nav {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      transition: all 0.2s;
    }
    
    .sidebar a:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: #ffc72c;
    }
    
    .sidebar a.active {
      background-color: #ffc72c;
      color: #4b2d72;
      font-weight: 500;
    }
    
    .sidebar i {
      width: 1.5rem;
      text-align: center;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    .dashboard-container {
      background: rgba(255, 255, 255, 0.9);
      padding: 30px;
      border-radius: 8px;
      margin: 20px 0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .btn-approve {
      background-color: #10b981;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-primary {
      background-color: var(--primary);
      color: white;
    }
    .btn-primary:hover {
      background-color: #3a235a;
    }
    .btn-success {
      background-color: var(--success);
      color: white;
    }
    .btn-success:hover {
      background-color: #218838;
    }
    .badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }
    .badge-success {
      background-color: #d4edda;
      color: #155724;
    }
    .badge-warning {
      background-color: #fff3cd;
      color: #856404;
    }
    .badge {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-align: center;
      white-space: nowrap;
    }
    
    .badge-success {
      background-color: #d1fae5;
      color: #065f46;
    }
    
    .badge-warning {
      background-color: #fef3c7;
      color: #92400e;
    }
    
    .badge-danger {
      background-color: #fee2e2;
      color: #b91c1c;
    }
    
    .badge-secondary {
      background-color: #e5e7eb;
      color: #374151;
    }
    .table-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    thead {
      background-color: #f9fafb;
      border-bottom: 2px solid #e5e7eb;
    }
    th {
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      color: #4b5563;
      text-transform: uppercase;
      font-size: 0.75rem;
      letter-spacing: 0.05em;
      border-bottom: 2px solid #e5e7eb;
    }
    td {
      padding: 16px;
      border-bottom: 1px solid #e5e7eb;
      color: #1f2937;
      font-size: 0.875rem;
    }
    tr:last-child td {
      border-bottom: none;
    }
    tbody tr:hover {
      background-color: #f9fafb;
    }
    
    /* Ensure the table takes full width and is scrollable on mobile */
    .main-content {
      margin-left: 250px;
      width: calc(100% - 250px);
      overflow-x: auto;
      padding: 1.5rem;
      min-width: 0;
      box-sizing: border-box;
    }
    
    /* Responsive adjustments for different screen sizes */
    @media (max-width: 1200px) {
      .main-content {
        padding: 1rem;
      }
      
      .container {
        max-width: 100%;
        padding: 0 10px;
      }
    }
    
    @media (max-width: 1024px) {
      .sidebar {
        width: 200px;
      }
      
      .main-content {
        margin-left: 200px;
        width: calc(100% - 200px);
      }
      
      .sidebar a {
        padding: 0.6rem 0.75rem;
        font-size: 0.875rem;
      }
      
      .sidebar h2 {
        font-size: 1.1rem;
      }
    }
    
    @media (max-width: 900px) {
      .sidebar {
        width: 180px;
      }
      
      .main-content {
        margin-left: 180px;
        width: calc(100% - 180px);
      }
      
      .sidebar a {
        padding: 0.5rem 0.6rem;
        font-size: 0.8rem;
        gap: 0.5rem;
      }
      
      .sidebar i {
        width: 1.2rem;
        font-size: 0.9rem;
      }
      
      th, td {
        padding: 8px 6px;
        font-size: 0.8rem;
      }
    }
      
    .sidebar-user {
      padding: 0.75rem;
      background-color: rgba(255, 199, 44, 0.1);
      border-radius: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid rgba(255, 199, 44, 0.2);
    }
    
    .sidebar-user-name {
      color: #ffc72c;
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .sidebar-logout-btn {
      background-color: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 0.5rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      cursor: pointer;
      width: 100%;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }
    
    .sidebar-logout-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
    }
  </style>
</head>
<body>
  <!-- Activity Log Modal (hidden, kept for future use) -->
  <div id="activityLogModal" class="hidden"></div>

  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Bucksport LL</h2>
    </div>
    <!-- User Welcome Section -->
    <div class="sidebar-user" id="sidebarUserSection" style="display: none;">
      <div class="sidebar-user-name" id="sidebarUserName">Welcome, User</div>
      <button class="sidebar-logout-btn" id="sidebarLogoutBtn">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
    </div>
    <nav class="sidebar-nav">
      <a href="index.html"><i class="fas fa-home"></i> Home</a>
      <a href="teams.html"><i class="fas fa-users"></i> Teams</a>
      <a href="coach-dashboard.html"><i class="fas fa-tachometer-alt"></i> Coach Dashboard</a>
      <a href="inventory.html" class="active"><i class="fas fa-tshirt"></i> Equipment Inventory</a>
      <a href="schedule.html"><i class="fas fa-calendar-alt"></i> Schedule</a>
      <a href="concessions.html"><i class="fas fa-hamburger"></i> Concessions</a>
      <a href="event_concessions.html"><i class="fas fa-clipboard-list"></i> Event Concessions</a>
      <a href="fundraising.html"><i class="fas fa-hand-holding-usd"></i> Fundraising & Donations</a>
</nav>
  </div>

  <!-- Main Content -->
  <div class="container" style="margin-left: 250px; width: calc(100% - 250px);">
    <div class="main-content" style="flex-grow: 1;">
    <div class="container mx-auto px-4">
      <header class="text-center py-8 relative">
        <div class="flex flex-col items-center">
          <img src="images/logo.png" alt="Bucksport Little League" class="h-20 mb-4" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">
          <h1 class="text-3xl font-extrabold" style="color: #ffc72c; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">Equipment & Uniform Inventory</h1>
        </div>
        <!-- Activity Log Button -->
        <button id="viewActivityLog" class="absolute top-8 right-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-semibold transition-colors">
          <i class="fas fa-history"></i> Activity Log
        </button>
      </header>

      <div style="margin-bottom: 30px;">
        <h2 style="color: #4b2d72; border-bottom: 2px solid #ffc72c; padding-bottom: 8px; margin-bottom: 20px;">
          <i class="fas fa-tshirt"></i> Inventory Summary
        </h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 24px;">
          <!-- Total Items -->
          <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; font-weight: 500; color: #6b7280; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-boxes" style="color: #4b2d72; font-size: 1rem;"></i>
              <span>Total Items</span>
            </h3>
            <div id="total-items-value" style="font-size: 1.875rem; font-weight: 700; color: #111827;">...</div>
          </div>
          
          <!-- Available -->
          <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; font-weight: 500; color: #6b7280; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem;"></i>
              <span>Available</span>
            </h3>
            <div id="available-items-value" style="font-size: 1.875rem; font-weight: 700; color: #111827;">...</div>
          </div>
          
          <!-- Checked Out -->
          <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; font-weight: 500; color: #6b7280; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-sign-out-alt" style="color: #3b82f6; font-size: 1rem;"></i>
              <span>Checked Out</span>
            </h3>
            <div id="checked-out-items-value" style="font-size: 1.875rem; font-weight: 700; color: #111827;">...</div>
          </div>
          
          <!-- Needs Repair -->
          <div style="background: white; border-radius: 8px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <h3 style="margin: 0 0 12px 0; font-size: 0.875rem; font-weight: 500; color: #6b7280; display: flex; align-items: center; gap: 8px;">
              <i class="fas fa-tools" style="color: #f59e0b; font-size: 1rem;"></i>
              <span>Needs Repair</span>
            </h3>
            <div id="needs-repair-items-value" style="font-size: 1.875rem; font-weight: 700; color: #111827;">...</div>
          </div>
        </div>
      </div>

      <!-- Filter Section -->
      <div class="filter-bar" style="background: white; border-radius: 8px; padding: 16px; margin-bottom: 24px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
        <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: flex-end;">
          <div style="flex: 1; min-width: 150px;">
            <label style="display: block; font-size: 0.875rem; color: #4b5563; margin-bottom: 4px; font-weight: 500;">Division</label>
            <select id="divisionFilter" class="filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; font-size: 0.875rem; color: #1f2937;">
              <option value="">All Divisions</option>
              <option value="Baseball">Baseball</option>
              <option value="Softball">Softball</option>
              <option value="Shared">Shared</option>
            </select>
          </div>
          
          <div style="flex: 1; min-width: 200px;">
            <label style="display: block; font-size: 0.875rem; color: #4b5563; margin-bottom: 4px; font-weight: 500;">Category</label>
            <select id="categoryFilter" class="filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; font-size: 0.875rem; color: #1f2937;">
              <option value="">All Categories</option>
            </select>
          </div>
          
          <div style="flex: 1; min-width: 180px;">
            <label style="display: block; font-size: 0.875rem; color: #4b5563; margin-bottom: 4px; font-weight: 500;">Status</label>
            <select id="statusFilter" class="filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; font-size: 0.875rem; color: #1f2937;">
              <option value="">All Statuses</option>
            </select>
          </div>
          
          <div style="flex: 1; min-width: 180px;">
            <label style="display: block; font-size: 0.875rem; color: #4b5563; margin-bottom: 4px; font-weight: 500;">Team</label>
            <select id="teamFilter" class="filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; font-size: 0.875rem; color: #1f2937;">
              <option value="">All Teams</option>
            </select>
          </div>
          
          <div style="flex: 1; min-width: 200px;">
            <label style="display: block; font-size: 0.875rem; color: #4b5563; margin-bottom: 4px; font-weight: 500;">Assigned Coach</label>
            <select id="coachFilter" class="filter-select" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; font-size: 0.875rem; color: #1f2937;">
              <option value="">All Coaches</option>
            </select>
          </div>
          
          <button class="btn-approve" style="padding: 8px 16px; background-color: #4b2d72; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.875rem; height: 38px;">
            <i class="fas fa-filter"></i> Apply Filters
          </button>
        </div>
      </div>

      <!-- Add New Item Button -->
      <div style="margin-bottom: 20px; display: flex; justify-content: flex-end;">
        <button id="addItemBtn" class="btn-approve" style="padding: 10px 20px; background-color: #10b981; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 0.875rem; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#059669'" onmouseout="this.style.backgroundColor='#10b981'">
          <i class="fas fa-plus"></i> Add New Item
        </button>
      </div>

      <!-- Inventory Table -->
      <div class="section" style="margin-top: 30px;">
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div style="padding: 16px 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
            <h2 style="margin: 0; color: #4b2d72; font-size: 1.125rem; font-weight: 600; display: flex; align-items: center;">
              <i class="fas fa-list-ul" style="margin-right: 10px; color: #ffc72c; font-size: 1.1em;"></i> Inventory Items
            </h2>
            <div style="display: flex; gap: 12px;">
              <button style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; color: #4b5563; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; transition: all 0.2s;" onmouseover="this.style.borderColor='#9ca3af'; this.style.backgroundColor='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='white'">
                <i class="fas fa-file-export" style="margin-right: 6px; font-size: 0.9em;"></i> Export
              </button>
              <button style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; color: #4b5563; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; transition: all 0.2s;" onmouseover="this.style.borderColor='#9ca3af'; this.style.backgroundColor='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='white'">
                <i class="fas fa-print" style="margin-right: 6px; font-size: 0.9em;"></i> Print
              </button>
            </div>
          </div>
          
          <div style="overflow-x: auto; -webkit-overflow-scrolling: touch; max-height: calc(100vh - 400px); overflow-y: auto;">
            <table style="width: 100%; border-collapse: collapse; min-width: 1000px;">
              <thead>
                <tr style="background-color: #f9fafb; border-bottom: 2px solid #e5e7eb;">
                  <th data-sort="name" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Item <span class="sort-indicator"></span></th>
                  <th data-sort="division" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Division <span class="sort-indicator"></span></th>
                  <th data-sort="category" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Category <span class="sort-indicator"></span></th>
                  <th data-sort="size" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Size <span class="sort-indicator"></span></th>
                  <th data-sort="team" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Team <span class="sort-indicator"></span></th>
                  <th data-sort="assigned_coach" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Assigned To <span class="sort-indicator"></span></th>
                  <th data-sort="quantity" style="padding: 12px 16px; text-align: right; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Qty <span class="sort-indicator"></span></th>
                  <th data-sort="status" style="padding: 12px 16px; text-align: left; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Status <span class="sort-indicator"></span></th>
                  <th data-sort="last_updated" style="padding: 12px 16px; text-align: right; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; cursor: pointer; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Last Updated <span class="sort-indicator"></span></th>
                  <th style="padding: 12px 16px; text-align: right; font-size: 0.75rem; font-weight: 600; color: #4b5563; text-transform: uppercase; letter-spacing: 0.05em; position: sticky; top: 0; background-color: #f9fafb; z-index: 10;">Actions</th>
                </tr>
              </thead>
              <tbody id="inventory-table-body">
                <!-- Inventory items will be populated here by JavaScript -->
              </tbody> 
              <tbody id='inventoryTableBody'></tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          <div style="padding: 16px 24px; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center; background-color: #f9fafb;">
            <div style="font-size: 0.875rem; color: #4b5563;">
              Showing <span style="font-weight: 600;">1</span> to <span style="font-weight: 600;">3</span> of <span style="font-weight: 600;">47</span> results
            </div>
            <div style="display: flex; gap: 8px;">
              <button style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; color: #4b5563; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; transition: all 0.2s;" onmouseover="this.style.borderColor='#9ca3af'; this.style.backgroundColor='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='white'">
                <i class="fas fa-chevron-left" style="font-size: 0.7em; margin-right: 4px;"></i> Previous
              </button>
              <button style="padding: 6px 12px; border: 1px solid #4b2d72; border-radius: 6px; background-color: #4b2d72; color: white; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.backgroundColor='#3d245c'" onmouseout="this.style.backgroundColor='#4b2d72'">
                1
              </button>
              <button style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; color: #4b5563; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#9ca3af'; this.style.backgroundColor='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='white'">
                2
              </button>
              <button style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; color: #4b5563; font-size: 0.875rem; font-weight: 500; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.borderColor='#9ca3af'; this.style.backgroundColor='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='white'">
                3
              </button>
              <button style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 6px; background-color: white; color: #4b5563; font-size: 0.875rem; font-weight: 500; cursor: pointer; display: flex; align-items: center; transition: all 0.2s;" onmouseover="this.style.borderColor='#9ca3af'; this.style.backgroundColor='#f9fafb'" onmouseout="this.style.borderColor='#d1d5db'; this.style.backgroundColor='white'">
                Next <i class="fas fa-chevron-right" style="font-size: 0.7em; margin-left: 4px;"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Item Modal -->
  <div id="itemModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div class="modal-content" style="background: white; padding: 24px; border-radius: 8px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid #e5e7eb;">
        <h3 style="margin: 0; font-size: 1.25rem; font-weight: 600; color: #111827;">Add New Inventory Item</h3>
        <button id="closeModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280;">&times;</button>
      </div>
      <form id="itemForm">
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Item Name *</label>
            <input type="text" id="itemName" name="itemName" required style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Category *</label>
            <select id="category" name="category" required style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;">
              <option value="">Select Category</option>
              <option value="jersey">Jersey</option>
              <option value="pants">Pants</option>
              <option value="hat">Hat</option>
              <option value="cleats">Cleats</option>
              <option value="bat">Bat</option>
              <option value="ball">Baseball/Softball</option>
              <option value="glove">Glove</option>
              <option value="helmet">Helmet</option>
              <option value="other">Other Equipment</option>
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Size</label>
            <input type="text" id="size" name="size" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;" placeholder="e.g., M, L, XL, 10, 12">
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Team</label>
            <select id="itemTeam" name="team" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;">
              <option value="">Select Team</option>
              <option value="Unassigned">Unassigned</option>
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Assigned Coach</label>
            <select id="assignedCoach" name="assignedCoach" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;">
              <option value="unassigned">Unassigned</option>
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Quantity *</label>
            <input type="number" id="quantity" name="quantity" min="0" value="1" required style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Status *</label>
            <select id="status" name="status" required style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; color: #1f2937;">
              <option value="in-stock">In Stock</option>
              <option value="low-stock">Low Stock</option>
              <option value="out-of-stock">Out of Stock</option>
              <option value="needs-repair">Needs Repair</option>
              <option value="retired">Retired</option>
            </select>
          </div>
          <div style="grid-column: span 2;">
            <label style="display: block; margin-bottom: 4px; font-size: 0.875rem; font-weight: 500; color: #4b5563;">Notes</label>
            <textarea id="notes" name="notes" style="width: 100%; padding: 8px 12px; border: 1px solid #d1d5db; border-radius: 6px; min-height: 80px; color: #1f2937;" placeholder="Any additional notes about this item"></textarea>
          </div>
        </div>
        <div style="margin-top: 24px; display: flex; justify-content: flex-end; gap: 12px;">
          <button type="button" id="cancelBtn" style="padding: 8px 16px; background: white; border: 1px solid #d1d5db; border-radius: 6px; cursor: pointer; font-weight: 500; color: #4b5563;">
            Cancel
          </button>
          <button type="submit" style="padding: 8px 16px; background: #4b2d72; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">
            Save Item
          </button>
        </div>
      </form>
    </div>
  </div>

<script src="js/auth.js"></script>
<script src="js/api.js"></script>
<script src="js/activity-log.js"></script>
<script>
// Initialize Activity Logger - make it globally accessible
var activityLogger = null;

document.addEventListener('DOMContentLoaded', () => {
  console.log('Initializing activity logger...');
  
  // Check if ActivityLogger class exists
  if (typeof ActivityLogger === 'undefined') {
    console.error('ActivityLogger class not found - activity-log.js may not be loaded');
    return;
  }
  
  activityLogger = new ActivityLogger('inventory');
  console.log('ActivityLogger created');
  
  // Create modal HTML directly inline
  const modalHTML = `
    <div id="activityLogModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 9999; background-color: rgba(0, 0, 0, 0.5); align-items: center; justify-content: center;">
      <div style="background-color: white; border-radius: 8px; width: 90%; max-width: 1000px; max-height: 90vh; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #e5e7eb; padding: 16px; background-color: #7c3aed; color: white;">
          <h3 style="font-size: 18px; font-weight: 600; margin: 0;"><i class="fas fa-history" style="margin-right: 8px;"></i>Activity Log</h3>
          <button id="closeActivityLog" style="background: none; border: none; color: white; font-size: 24px; cursor: pointer; padding: 0; line-height: 1;">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div id="activityLogContent" style="overflow-y: auto; max-height: calc(90vh - 80px); padding: 16px;">
          <!-- Activity entries will be inserted here -->
        </div>
      </div>
    </div>
  `;
  document.body.insertAdjacentHTML('beforeend', modalHTML);
  console.log('Custom activity log modal created');
  
  // Add click handlers
  const activityBtn = document.getElementById('viewActivityLog');
  const modal = document.getElementById('activityLogModal');
  const closeBtn = document.getElementById('closeActivityLog');
  
  if (activityBtn && modal) {
    console.log('Adding click handler to activity log button');
    activityBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      console.log('Activity log button clicked!');
      await activityLogger.renderActivityLog('activityLogContent');
      modal.style.display = 'flex';
      console.log('Modal should now be visible');
    });
  }
  
  if (closeBtn && modal) {
    closeBtn.addEventListener('click', () => {
      modal.style.display = 'none';
    });
    
    // Close when clicking outside
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });
  }
});
</script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    // --- DOM Elements ---
    const inventoryTableBody = document.getElementById('inventory-table-body');
    const totalItemsEl = document.getElementById('total-items-value');
    const availableItemsEl = document.getElementById('available-items-value');
    const checkedOutItemsEl = document.getElementById('checked-out-items-value');
    const needsRepairItemsEl = document.getElementById('needs-repair-items-value');

    const divisionFilterEl = document.getElementById('divisionFilter');
    const categoryFilterEl = document.getElementById('categoryFilter');
    const statusFilterEl = document.getElementById('statusFilter');
    const teamFilterEl = document.getElementById('teamFilter');
    const coachFilterEl = document.getElementById('coachFilter');
    const searchInput = document.getElementById('search-input');

    let allInventory = [];
    let allCoaches = [];

    // --- Utility Functions ---
    const getStatusBadge = (status) => {
        const statusClasses = {
            'in-stock': 'badge-success',
            'low-stock': 'badge-warning',
            'out-of-stock': 'badge-danger',
            'needs-repair': 'badge-warning',
            'retired': 'badge-secondary'
        };
        const statusText = status.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        return `<span class="badge ${statusClasses[status] || 'badge-secondary'} p-2 text-xs font-medium rounded-full">${statusText}</span>`;
    };

    const getDivisionBadge = (division) => {
        if (!division) return '<span class="text-gray-400">â€”</span>';
        const colors = {
            'Baseball': 'background-color: #1e40af; color: white;',
            'Softball': 'background-color: #be185d; color: white;',
            'Shared': 'background-color: #6b7280; color: white;'
        };
        return `<span style="${colors[division] || colors['Shared']} padding: 4px 10px; border-radius: 9999px; font-size: 0.75rem; font-weight: 500;">${division}</span>`;
    };

    // --- Render Functions ---
    const renderInventoryTable = (items) => {
        inventoryTableBody.innerHTML = '';
        if (!items || items.length === 0) {
            inventoryTableBody.innerHTML = '<tr><td colspan="10" class="text-center text-gray-500 py-8">No inventory items match the current filters.</td></tr>';
            return;
        }

        items.forEach(item => {
            const coachName = item.assigned_coach ? item.assigned_coach.name : 'Unassigned';
            const teamName = item.team ? item.team.name : 'Unassigned';
            const lastUpdated = item.last_updated ? new Date(item.last_updated).toLocaleDateString() : 'N/A';
            const divisionBadge = getDivisionBadge(item.division);
            
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-200 hover:bg-gray-50';
            row.innerHTML = `
                <td class="p-4"><div class="font-medium text-gray-800">${item.name}</div></td>
                <td class="p-4">${divisionBadge}</td>
                <td class="p-4 text-gray-600">${item.category}</td>
                <td class="p-4 text-gray-600">${item.size || 'N/A'}</td>
                <td class="p-4 text-gray-600">${teamName}</td>
                <td class="p-4 text-gray-600">${coachName}</td>
                <td class="p-4 text-right font-medium text-gray-800">${item.quantity}</td>
                <td class="p-4">${getStatusBadge(item.status)}</td>
                <td class="p-4 text-right text-gray-600">${lastUpdated}</td>
                <td class="p-4 text-right">
                    <button class="edit-btn text-blue-600 hover:text-blue-800 p-1" data-id="${item.id}" title="Edit Item"><i class="fas fa-edit"></i></button>
                    <button class="delete-btn text-red-600 hover:text-red-800 p-1" data-id="${item.id}" title="Delete Item"><i class="fas fa-trash"></i></button>
                </td>
            `;
            inventoryTableBody.appendChild(row);
        });
    };

    const renderSummary = (summary) => {
        totalItemsEl.textContent = summary.total_items || '0';
        availableItemsEl.textContent = summary.available || '0';
        checkedOutItemsEl.textContent = summary.checked_out || '0';
        needsRepairItemsEl.textContent = summary.needs_repair || '0';
    };

    const populateDropdown = (selectElement, options, defaultOptionText) => {
        if (!selectElement) return;
        selectElement.innerHTML = `<option value="">${defaultOptionText}</option>`;
        if (!options) return;
        
        options.forEach(option => {
            const value = typeof option === 'object' ? option.id : option;
            const text = typeof option === 'object' ? option.name : option;
            const optionEl = document.createElement('option');
            optionEl.value = value;
            optionEl.textContent = text;
            selectElement.appendChild(optionEl);
        });
    };

    // --- Data Fetching and Initialization ---
    const initializePage = async () => {
        try {
            const [inventory, summary, coaches, teams, categories, statuses] = await Promise.all([
                fetchInventory(),
                fetchInventorySummary(),
                fetchCoaches(),
                fetchTeams(),
                fetchCategories(),
                fetchStatuses()
            ]);

            allInventory = inventory;
            allCoaches = coaches;

            renderInventoryTable(allInventory);
            renderSummary(summary);
            populateDropdown(categoryFilterEl, categories, 'All Categories');
            populateDropdown(statusFilterEl, statuses, 'All Statuses');
            populateDropdown(teamFilterEl, teams, 'All Teams');
            populateDropdown(coachFilterEl, allCoaches, 'All Coaches');

        } catch (error) {
            console.error('Failed to initialize page:', error);
            inventoryTableBody.innerHTML = '<tr><td colspan="9" class="text-center text-red-500 py-8">Failed to load inventory data. Please check the API connection and try again.</td></tr>';
        }
    };

    // --- Filtering Logic ---
    const applyFilters = () => {
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
        const division = divisionFilterEl ? divisionFilterEl.value : '';
        const category = categoryFilterEl ? categoryFilterEl.value : '';
        const status = statusFilterEl ? statusFilterEl.value : '';
        const teamId = teamFilterEl ? teamFilterEl.value : '';
        const coachId = coachFilterEl ? coachFilterEl.value : '';

        let filteredInventory = allInventory.filter(item => {
            const divisionMatch = !division || item.division === division;
            const teamMatch = !teamId || (item.team && item.team.id == teamId);
            const coachMatch = !coachId || (item.assigned_coach && item.assigned_coach.id == coachId);
            const categoryMatch = !category || item.category === category;
            const statusMatch = !status || item.status === status;
            const searchMatch = !searchTerm || item.name.toLowerCase().includes(searchTerm);

            return divisionMatch && teamMatch && coachMatch && categoryMatch && statusMatch && searchMatch;
        });
        renderInventoryTable(filteredInventory);
    };

    // --- Event Listeners ---
    [searchInput, divisionFilterEl, categoryFilterEl, statusFilterEl, teamFilterEl, coachFilterEl].forEach(el => {
        if (el) {
            const eventType = el.tagName === 'INPUT' ? 'keyup' : 'change';
            el.addEventListener(eventType, applyFilters);
        }
    });

    // Add New Item button
    const addItemBtn = document.getElementById('addItemBtn');
    const itemModal = document.getElementById('itemModal');
    const closeModalBtn = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const itemForm = document.getElementById('itemForm');
    const itemTeamSelect = document.getElementById('itemTeam');
    const assignedCoachSelect = document.getElementById('assignedCoach');
    
    // Populate modal dropdowns when opening
    const populateModalDropdowns = async () => {
        try {
            const [teams, coaches] = await Promise.all([
                fetchTeams(),
                fetchCoaches()
            ]);
            
            // Populate teams
            if (itemTeamSelect) {
                itemTeamSelect.innerHTML = '<option value="">Select Team</option><option value="Unassigned">Unassigned</option>';
                teams.forEach(team => {
                    const option = document.createElement('option');
                    option.value = team.id;
                    option.textContent = team.name;
                    itemTeamSelect.appendChild(option);
                });
            }
            
            // Populate coaches
            if (assignedCoachSelect) {
                assignedCoachSelect.innerHTML = '<option value="unassigned">Unassigned</option>';
                coaches.forEach(coach => {
                    const option = document.createElement('option');
                    option.value = coach.id;
                    option.textContent = coach.name;
                    assignedCoachSelect.appendChild(option);
                });
            }
        } catch (error) {
            console.error('Failed to populate modal dropdowns:', error);
        }
    };
    
    if (addItemBtn) {
        addItemBtn.addEventListener('click', async () => {
            console.log('Add New Item clicked - clearing currentEditId');
            currentEditId = null;
            console.log('currentEditId is now:', currentEditId);
            if (itemModal) {
                await populateModalDropdowns();
                itemModal.style.display = 'flex';
                
                // Reset modal title
                const modalTitle = document.querySelector('#itemModal h3');
                if (modalTitle) modalTitle.textContent = 'Add New Inventory Item';
                
                // Clear form
                if (itemForm) itemForm.reset();
            }
        });
    }
    
    // Close modal
    const closeModal = () => {
        if (itemModal) {
            itemModal.style.display = 'none';
            if (itemForm) itemForm.reset();
            currentEditId = null;
            const modalTitle = document.querySelector('#itemModal h3');
            if (modalTitle) modalTitle.textContent = 'Add New Inventory Item';
        }
    };
    
    if (closeModalBtn) {
        closeModalBtn.addEventListener('click', closeModal);
    }
    
    if (cancelBtn) {
        cancelBtn.addEventListener('click', closeModal);
    }
    
    // Close modal when clicking outside
    if (itemModal) {
        itemModal.addEventListener('click', (e) => {
            if (e.target === itemModal) {
                closeModal();
            }
        });
    }
    
    // Old form submission handler removed - using the new one below that handles both create and update

    // --- Edit and Delete Handlers ---
    let currentEditId = null;
    
    // Use event delegation for dynamically created buttons
    if (inventoryTableBody) {
        inventoryTableBody.addEventListener('click', async (e) => {
            const editBtn = e.target.closest('.edit-btn');
            const deleteBtn = e.target.closest('.delete-btn');
            
            if (editBtn) {
                const itemId = editBtn.getAttribute('data-id');
                await handleEdit(itemId);
            } else if (deleteBtn) {
                const itemId = deleteBtn.getAttribute('data-id');
                await handleDelete(itemId);
            }
        });
    }
    
    async function handleEdit(itemId) {
        console.log('handleEdit called with itemId:', itemId);
        // Find the item in allInventory
        const item = allInventory.find(i => i.id == itemId);
        if (!item) {
            alert('Item not found');
            return;
        }
        
        currentEditId = itemId;
        console.log('currentEditId set to:', currentEditId);
        
        // Show modal first
        if (itemModal) {
            itemModal.style.display = 'flex';
        }
        
        // Change modal title
        const modalTitle = document.querySelector('#itemModal h3');
        if (modalTitle) modalTitle.textContent = 'Edit Inventory Item';
        
        // Populate dropdowns first
        await populateModalDropdowns();
        
        // Populate modal with item data
        const itemNameEl = document.getElementById('itemName');
        const categoryEl = document.getElementById('category');
        const sizeEl = document.getElementById('size');
        const quantityEl = document.getElementById('quantity');
        const statusEl = document.getElementById('status');
        const notesEl = document.getElementById('notes');
        
        if (itemNameEl) itemNameEl.value = item.name || '';
        if (categoryEl) categoryEl.value = item.category || '';
        if (sizeEl) sizeEl.value = item.size || '';
        if (quantityEl) quantityEl.value = item.quantity || 1;
        if (statusEl) statusEl.value = item.status || 'in-stock';
        if (notesEl) notesEl.value = item.notes || '';
        
        // Set team and coach if they exist
        if (item.team && item.team.id) {
            const teamEl = document.getElementById('itemTeam');
            if (teamEl) teamEl.value = item.team.id;
        }
        if (item.assigned_coach && item.assigned_coach.id) {
            const coachEl = document.getElementById('assignedCoach');
            if (coachEl) coachEl.value = item.assigned_coach.id;
        }
    }
    
    async function handleDelete(itemId) {
        const item = allInventory.find(i => i.id == itemId);
        if (!item) {
            alert('Item not found');
            return;
        }
        
        if (!confirm(`Are you sure you want to delete "${item.name}"?`)) {
            return;
        }
        
        try {
            const response = await fetch(`${API_BASE_URL}/api/inventory/${itemId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                throw new Error('Failed to delete item');
            }
            
            // Log activity
            if (activityLogger) {
                await activityLogger.logActivity('Item Deleted', `Deleted item: ${item.name}`, itemId);
            }
            
            alert('Item deleted successfully!');
            await initializePage();
        } catch (error) {
            console.error('Failed to delete item:', error);
            alert('Failed to delete item. Please try again.');
        }
    }
    
    // Update form submission to handle both create and update
    if (itemForm) {
        itemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(itemForm);
            const itemData = {
                name: formData.get('itemName'),
                category: formData.get('category'),
                size: formData.get('size') || null,
                team: formData.get('team') || null,
                assigned_coach: formData.get('assignedCoach') === 'unassigned' ? null : formData.get('assignedCoach'),
                quantity: parseInt(formData.get('quantity')),
                status: formData.get('status'),
                notes: formData.get('notes') || ''
            };
            
            console.log('Form submit - currentEditId:', currentEditId);
            
            try {
                let response;
                if (currentEditId) {
                    console.log('Updating existing item with ID:', currentEditId);
                    // Update existing item
                    response = await fetch(`${API_BASE_URL}/api/inventory/${currentEditId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(itemData)
                    });
                } else {
                    // Create new item
                    response = await fetch(`${API_BASE_URL}/api/inventory`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(itemData)
                    });
                }
                
                if (!response.ok) {
                    throw new Error('Failed to save item');
                }
                
                // Log activity
                if (activityLogger) {
                    const action = currentEditId ? 'Item Updated' : 'Item Added';
                    const message = currentEditId ? `Updated item: ${itemData.name}` : `Added new item: ${itemData.name}`;
                    await activityLogger.logActivity(action, message, currentEditId);
                }
                
                alert(currentEditId ? 'Item updated successfully!' : 'Item added successfully!');
                closeModal();
                currentEditId = null;
                
                // Reset modal title
                const modalTitle = document.querySelector('#itemModal h3');
                if (modalTitle) modalTitle.textContent = 'Add New Inventory Item';
                
                // Refresh the inventory
                await initializePage();
            } catch (error) {
                console.error('Failed to save item:', error);
                alert('Failed to save item. Please try again.');
            }
        });
    }

    // --- Sorting Functionality ---
    let currentSortColumn = null;
    let currentSortDirection = 'asc';

    function sortTable(column) {
        // Toggle direction if clicking same column
        if (currentSortColumn === column) {
            currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
        } else {
            currentSortColumn = column;
            currentSortDirection = 'asc';
        }

        // Sort the filtered inventory
        const sortedInventory = [...allInventory].sort((a, b) => {
            let aVal = a[column];
            let bVal = b[column];

            // Handle nested objects (team, assigned_coach)
            if (column === 'team') {
                aVal = a.team?.name || 'Unassigned';
                bVal = b.team?.name || 'Unassigned';
            } else if (column === 'assigned_coach') {
                aVal = a.assigned_coach?.name || 'Unassigned';
                bVal = b.assigned_coach?.name || 'Unassigned';
            }

            // Handle null/undefined
            if (aVal == null) aVal = '';
            if (bVal == null) bVal = '';

            // Numeric comparison for quantity
            if (column === 'quantity') {
                return currentSortDirection === 'asc' ? aVal - bVal : bVal - aVal;
            }

            // String comparison
            const comparison = String(aVal).localeCompare(String(bVal));
            return currentSortDirection === 'asc' ? comparison : -comparison;
        });

        // Update sort indicators
        document.querySelectorAll('th[data-sort] .sort-indicator').forEach(indicator => {
            indicator.textContent = '';
        });
        const activeHeader = document.querySelector(`th[data-sort="${column}"] .sort-indicator`);
        if (activeHeader) {
            activeHeader.textContent = currentSortDirection === 'asc' ? ' â–²' : ' â–¼';
        }

        renderInventoryTable(sortedInventory);
    }

    // Add click handlers to sortable headers
    document.querySelectorAll('th[data-sort]').forEach(header => {
        header.addEventListener('click', () => {
            const column = header.getAttribute('data-sort');
            sortTable(column);
        });
    });

    // --- Initial Load ---
    initializePage();
});
</script>
</body>
</html>
